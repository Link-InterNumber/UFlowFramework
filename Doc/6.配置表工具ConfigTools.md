# 配置表工具使用说明

## 简介

本工具是一个基于 Unity 的配置表管理工具，支持从 Excel 文件生成配置数据，并以多种格式（如 ScriptableObject、JSON、二进制）保存和加载。工具还支持本地化功能，可以将配置中的本地化字符串导出为 CSV 文件。

## 功能

1. **配置表生成**
    - 从 Excel 文件生成配置数据。
    - 支持多种数据类型（如 `int`、`float`、`string`、`bool` 等）。
    - 支持数组类型（如 `int[]`、`float[]` 等）。
    - 支持本地化字符串和资源引用。

2. **多种存储格式**
    - 支持 ScriptableObject、JSON 和二进制格式保存配置数据。

3. **本地化支持**
    - 自动提取配置中的本地化字符串和资源。
    - 导出本地化数据为 CSV 文件。

4. **异步加载**
    - 支持异步加载配置数据，适用于大规模配置表。

5. **自动代码生成**
    - 自动生成配置表对应的 C# 类和管理类。

## 文件结构

- `ConfigSettingWindow.cs`  
  提供配置工具的设置窗口，允许用户设置 Excel 文件路径、生成的脚本路径和资源路径。

- `ConfigWriter.cs`  
  负责从 Excel 文件生成配置表对应的 C# 类和数据文件。

- `ExcelReader.cs`  
  用于读取 Excel 文件并解析字段信息。

- `ConfBase.cs`  
  定义配置表的基础类和集合类。

- `ConfAsyncLoadHandle.cs`  
  提供异步加载配置数据的功能。

- `AssetRef` 文件夹  
  定义资源引用类型（如 `AudioRef`、`SpriteRef`、`LocalizationStringRef` 等）。

## 使用方法

### 1. 设置路径

打开 Unity 菜单 `Tools > Config > Config Setting Window`，设置以下路径：

- **Excel 文件路径**：存放 Excel 配置表的文件夹路径。
- **脚本文件路径**：生成的 C# 脚本存放路径。
- **资源文件路径**：生成的配置资源存放路径。

### 2. 生成配置表

在 `Config Setting Window` 中点击以下按钮：

- **Create Cs Files**：根据 Excel 文件生成对应的 C# 类。
- **Create Config Assets**：生成配置表数据文件。
- **Delete Config Assets**：删除已生成的配置表数据文件。

### 3. 本地化支持

- **Create Localization csv**：提取配置表中的本地化字符串和资源，生成 CSV 文件。

### 4. 加载配置

使用 `ConfigManager` 类加载配置表：

```csharp
var configManager = ConfigManager.instance;
yield return configManager.Init(OnConfigLoadCompleted);

void OnConfigLoadCompleted(AssetLoadStatus status)
{
    if (status == AssetLoadStatus.Loaded)
    {
        Debug.Log("配置加载成功");
    }
    else
    {
        Debug.LogError("配置加载失败");
    }
}
```

### 5. 获取配置数据

通过 `ConfigManager` 获取具体配置表数据：

```csharp
var roleConfig = ConfigManager.instance.rolePropConf.Get(roleId);
Debug.Log($"角色名称: {roleConfig.name}");
```

## Excel 文件格式

1. 第一行：字段注释。
2. 第二行：字段名称（可用 `:key` 标记主键）。
3. 第三行：字段类型（如 `int`、`string`、`float[]` 等）。
4. 第四行及以后：数据内容。

示例：

| 注释       | id:key | 名称       | 属性值   |
|------------|--------|------------|----------|
| 字段名称   | id     | name       | value    |
| 字段类型   | int    | string     | float[]  |
| 数据       | 1      | 英雄       | 10,20,30 |
| 数据       | 2      | 怪物       | 5,15,25  |

## 注意事项

1. Excel 文件需保存为 `.xlsx` 格式。
2. 字段名称不能重复，主键字段需使用 `:key` 标记。
3. 本地化字段需使用 `LocalizationStringRef` 或 `LocalizationAssetRef` 类型。

## 依赖

- Unity 2020.3 或更高版本。
- [EPPlus](https://github.com/EPPlusSoftware/EPPlus) 用于解析 Excel 文件。
- [Newtonsoft.Json](https://www.newtonsoft.com/json) 用于 JSON 序列化和反序列化。

## 常见问题

1. **配置加载失败**  
   检查路径设置是否正确，确保 Excel 文件格式符合要求。

2. **本地化字符串未正确导出**  
   确保字段类型为 `LocalizationStringRef` 或 `LocalizationAssetRef`。

3. **生成的配置类字段缺失**  
   检查 Excel 文件的字段名称和类型是否正确填写。

## 许可证

本工具遵循 MIT 许可证，详情请查看 LICENSE 文件。
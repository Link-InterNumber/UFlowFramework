# ğŸ—‚ï¸ åˆ—è¡¨æ›´æ–°å·¥å…·

## 1. ğŸ› ï¸ åˆ—è¡¨æ›´æ–°å·¥å…· ListUpdater & ListItem

### ğŸ”— IListUpdater å’Œ IListItem æ¥å£

`IListUpdater` å’Œ `IListItem` æ˜¯ç”¨äºåˆ—è¡¨æ›´æ–°çš„æ¥å£ï¼Œæä¾›äº†åŸºæœ¬çš„æ›´æ–°å’Œæ“ä½œæ–¹æ³•ã€‚

`IListUpdater` ä½œä¸º `IListItem` çš„å®¹å™¨ï¼ŒåŒæ—¶è¿˜è´Ÿè´£å‘ `IListItem` ä¼ é€’æ•°æ®ã€å°† `IListItem` çš„äº¤äº’ä¿¡æ¯å‘ä¸Šä¼ é€’ã€‚

### ğŸ“‹ ListItem

`ListItem` æ˜¯åˆ—è¡¨é¡¹çš„åŸºç±»ï¼Œç»§æ‰¿è‡ª `IListItem` æ¥å£ï¼Œæ‰€æœ‰å­é¡¹éœ€è¦ç»§æ‰¿è‡ªå®ƒå¹¶å®ç° `UpdateContent` æ–¹æ³•ï¼Œç”¨äºæ›´æ–°æ˜¾ç¤ºå†…å®¹ã€‚

#### ä½¿ç”¨æ–¹æ³•
1. åˆ›å»ºä¸€ä¸ªç»§æ‰¿è‡ª `ListItem` çš„ç±»ã€‚

2. å®ç° `UpdateContent` æ–¹æ³•ï¼Œæ›´æ–° UI å…ƒç´ ã€‚

```csharp
public class CustomListItem : ListItem
{
    public Text label;

    public override void UpdateContent(int index, object data)
    {
        base.UpdateContent(index, data);
        label.text = data.ToString();
    }
}
```

3. å¯ä»¥å°†ç”¨æˆ·å¯¹ `ListItem` çš„äº¤äº’å‘ä¸Šä¼ é€’ã€‚

`IListUpdater` ä¸Šçš„ `onItemInteraction` æ˜¯ä¸ºäº†ç”¨æˆ·å’Œ `ListItem` äº¤äº’ï¼ˆå¯ä»¥é€šè¿‡ `Button`ã€`Toggle`ç­‰UIç»„ä»¶ï¼‰æ—¶ï¼Œåœ¨ä¸€ä¸ªèƒ½ç»Ÿä¸€ç®¡ç†æ•°æ®çš„ä½ç½®å¤„ç†é€»è¾‘ã€‚

åœ¨ `ListItem` ä¸­å¯ä»¥é€šè¿‡ `itemHolder.ItemInteraction(ListItem item, object data)` å°†æ•°æ®ä¼ é€’ç»™ `IListUpdater`ã€‚

åœ¨ç¼–å†™UIç•Œé¢æ—¶ä¼šéå¸¸ä¾¿åˆ©ï¼Œä¾‹å¦‚ï¼š

    - ä½ å¯ä»¥ç›´æ¥ä½¿ç”¨**window**ä¸Šçš„ `IAssetLoader`ï¼Œä¸ç”¨å†å»å’Œèµ„æºç®¡ç†ç»„ä»¶ç”³è¯·æ–°çš„ `IAssetLoader`ï¼Œèµ„æºç®¡ç†èƒ½é›†ä¸­åœ¨ç•Œé¢ä¸Šã€‚

    - ç¼–å†™è„šæœ¬ä¸ç”¨æ¥å›åˆ‡æ¢ä¸åŒæ–‡ä»¶ï¼Œåªåœ¨ `IListUpdater` æ‰€åœ¨è„šæœ¬å³å¯å®Œæˆäº¤äº’é€»è¾‘å¤„ç†ã€‚

    - å¯ä»¥åŒæ—¶æ”¯æŒä¸åŒçš„äº¤äº’æ–¹å¼ã€‚
    
    - å¿…è¦æ—¶ï¼Œèƒ½åœ¨äº¤äº’äº§ç”Ÿæ—¶é€šè¿‡ `IListUpdater` è°ƒåº¦å…¶ä¸‹çš„æ‰€æœ‰ `ListItem`ã€‚

```csharp
public class ListUpdaterExampleï¼š MonoBehaviour
{
    public ListUpdater listUpdater;

    private void Awake()
    {
        // æ³¨å†ŒListItemçš„äº¤äº’äº‹ä»¶
        listUpdater.onItemInteraction += OnItemClick;
    }

    private void OnDestory()
    {
        listUpdater.onItemInteraction -= OnItemClick;
    }

    private void OnItemClick(ListItem item, int itemIndex, object passData)
    {
        // ç±»å‹è½¬åŒ–
        CustomListItem casedItem = item as CustomListItem;
        CustomListItemData casedData = passData as CustomListItemData;

        if (casedItem == null || casedData == null) return;
        // do something...
    }
}

public class CustomListItem : ListItem
{
    public Button btn;

    private CustomListItemData _data;

    private void Awake()
    {
        btn.onClick.AddListener(OnClickBtn);
    }

    private void OnDestory()
    {
        btn.onClick.RemoveListener(OnClickBtn);
    }

    private void OnClickBtn()
    {
        if (_data == null) return;
        // åœ¨ç‚¹å‡»äº‹ä»¶ä¸­ï¼Œå°†æ•°æ®ä¼ é€’ç»™ IListUpdaterã€‚
        itemHolder.ItemInteraction(this, _data);
    }

    public override void UpdateContent(int index, object data)
    {
        base.UpdateContent(index, data);
        _data = data;
    }
}
```

### ğŸ”„ ListUpdater

`ListUpdater` æ˜¯ä¸€ä¸ªé€šç”¨çš„åˆ—è¡¨æ›´æ–°å·¥å…·ï¼Œç»§æ‰¿ `IListItem` æ¥å£ï¼Œé€‚ç”¨äºåŠ¨æ€æ›´æ–° UI åˆ—è¡¨ã€‚å®ƒæä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š
- **UpdateList**: ä¼ å…¥æ•°æ®åˆ—è¡¨å¹¶åˆ·æ–° UIã€‚
- **AddItem**: åœ¨æŒ‡å®šç´¢å¼•å¤„æ·»åŠ æ–°é¡¹ã€‚
- **RemoveItem**: ç§»é™¤æŒ‡å®šç´¢å¼•çš„é¡¹ã€‚
- **UpdateItem**: æ›´æ–°æŒ‡å®šç´¢å¼•çš„é¡¹å†…å®¹ã€‚
- **Clear**: éšè—æ‰€æœ‰å­èŠ‚ç‚¹ã€‚
- **FindItem**: æ ¹æ®æ¡ä»¶æŸ¥æ‰¾å­èŠ‚ç‚¹ã€‚
- **ForEachItem**: å¯¹æ‰€æœ‰å­èŠ‚ç‚¹æ‰§è¡Œæ“ä½œã€‚

#### ä½¿ç”¨æ–¹æ³•
1. å°† `ListUpdater` ç»„ä»¶æŒ‚è½½åˆ°ä¸€ä¸ªç©ºçš„ GameObject ä¸Šã€‚
2. åœ¨è¯¥ GameObject ä¸‹æ”¾ç½®ä¸€ä¸ªå­èŠ‚ç‚¹ä½œä¸ºæ¨¡æ¿ã€‚
3. è°ƒç”¨ `UpdateList` æ–¹æ³•ä¼ å…¥æ•°æ®åˆ—è¡¨ï¼ŒåŠ¨æ€ç”Ÿæˆ UIã€‚

```csharp
var listUpdater = GetComponent<ListUpdater>();
listUpdater.UpdateList(new List<string> { "Item 1", "Item 2", "Item 3" });
```

---

### â™»ï¸ RecycleScrollRect

`RecycleScrollRect` æ˜¯ä¸€ä¸ªä¼˜åŒ–çš„æ»šåŠ¨åˆ—è¡¨å·¥å…·ï¼Œç»§æ‰¿ `IListItem` æ¥å£ï¼Œé€‚ç”¨äºå¤§æ•°æ®é‡çš„åŠ¨æ€åˆ—è¡¨ã€‚å®ƒé€šè¿‡å¾ªç¯åˆ©ç”¨å°‘é‡èŠ‚ç‚¹å‡å°‘å†…å­˜åˆ†é…ï¼Œæå‡æ€§èƒ½ã€‚

`RecycleScrollRect` éœ€è¦å’Œ `ScrollRect`ã€`LayoutGroup` ç»„ä»¶é…åˆä½¿ç”¨ï¼Œæä¾›äº†é«˜æ•ˆçš„æ»šåŠ¨åˆ—è¡¨åŠŸèƒ½ã€‚

#### åŠŸèƒ½
- **UpdateList**: ä¼ å…¥æ•°æ®åˆ—è¡¨å¹¶åˆ·æ–°æ»šåŠ¨åˆ—è¡¨ã€‚
- **AddItem**: åœ¨æŒ‡å®šç´¢å¼•å¤„æ·»åŠ æ–°é¡¹ã€‚
- **RemoveItem**: ç§»é™¤æŒ‡å®šç´¢å¼•çš„é¡¹ã€‚
- **ForceRebuild**: å¼ºåˆ¶åˆ·æ–°æ˜¾ç¤ºèŒƒå›´å†…çš„æ•°æ®ã€‚
- **IsDataInVisible**: æ£€æŸ¥æŸé¡¹æ•°æ®æ˜¯å¦åœ¨å¯è§èŒƒå›´å†…ã€‚

#### ä½¿ç”¨æ–¹æ³•
1. å°† `RecycleScrollRect` ç»„ä»¶æŒ‚è½½åˆ°ä¸€ä¸ªåŒ…å« `ScrollRect` çš„ GameObject ä¸Šã€‚
2. è®¾ç½® `prefab` å±æ€§ä¸ºå­é¡¹æ¨¡æ¿ã€‚
3. è°ƒç”¨ `UpdateList` æ–¹æ³•ä¼ å…¥æ•°æ®åˆ—è¡¨ã€‚

```csharp
var recycleScrollRect = GetComponent<RecycleScrollRect>();
recycleScrollRect.UpdateList(new List<string> { "Item A", "Item B", "Item C" });
```

---
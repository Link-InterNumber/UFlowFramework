# å¯¹è±¡æ± åŠŸèƒ½

## ğŸ› ï¸ **åŠŸèƒ½å®ç°åŸç†**

UFlow ä½¿ç”¨çš„å¯¹è±¡æ± ç»“æ„å¦‚ä¸‹ï¼š

```plaintext
    PoolManager
        |
        â””â”€â”€ PoolGroup
                |
                â”œâ”€â”€ GameObjectPool (LinkPool<GameObject>) â”€â”€â”€â”€â”€â”€â”€ GameObject
                |
                â””â”€â”€ PoolableObjectPool (LinkPool<IPoolable>) â”€â”€â”€ PoolObject (IPoolable)
```

- **`IPoolable` å¯¹è±¡**ï¼šå¯¹è±¡æ± çš„æœ€å°å•ä½ï¼Œå¯ä»¥æ˜¯ç»§æ‰¿ `IPoolable` æ¥å£çš„å¯¹è±¡æˆ– `GameObject`ã€‚
- **`LinkPool<T>`**ï¼š`IPoolable` çš„å®¹å™¨ï¼Œè´Ÿè´£å¯¹è±¡çš„ç”Ÿæˆã€å­˜æ”¾ã€å›æ”¶å’Œé”€æ¯ã€‚
- **`PoolGroup`**ï¼š`LinkPool<T>` çš„å®¹å™¨ï¼Œç”¨äºåŒºåˆ†åœºæ™¯ä¸­çš„ä¸åŒå¯¹è±¡æ± é›†åˆï¼Œæ”¯æŒåŒæ—¶å®¹çº³ `GameObject` å’Œ `IPoolable` å¯¹è±¡ã€‚

> **æç¤º**ï¼šå¼€å‘è€…å¯ä»¥ç›´æ¥ä½¿ç”¨ `PoolGroup` å’Œ `LinkPool<T>` å®ç°å¯¹è±¡æ± åŠŸèƒ½ï¼Œè€Œæ— éœ€ä¾èµ– `PoolManager`ã€‚

---

## ğŸ§ª **æ“ä½œç¤ºä¾‹**

### 1.âœ¨ **é GameObject å¯¹è±¡æ± **

#### a.ğŸ”§ **ç»§æ‰¿ IPoolable æ¥å£**

éœ€è¦å¯¹è±¡æ± ç®¡ç†çš„å¯¹è±¡éœ€ç»§æ‰¿ `IPoolable` æ¥å£ã€‚ä»¥ä¸‹æ˜¯ç¤ºä¾‹ä»£ç ï¼š

```csharp
public class ExamplePoolObj : IPoolable
{
    public ExamplePoolObj()
    {
        _maybeData = new List<int>();
    }

    private List<int> _maybeData;

    public LinkPool<IPoolable> LinkPool { set; get; }

    // å¯¹è±¡ä»å¯¹è±¡æ± å–å‡ºæ—¶è°ƒç”¨
    public void OnSpawn()
    {
        _maybeData.Clear();
    }

    // å¯¹è±¡ä¸»åŠ¨å›æ”¶åˆ°å¯¹è±¡æ± 
    public void DeSpawn()
    {
        LinkPool.Release(this);
    }

    // å¯¹è±¡è¢«å›æ”¶æ—¶è°ƒç”¨
    public void OnDeSpawn()
    {
        for (var i = 0; i < _maybeData.Count; i++)
        {
            Debug.Log(_maybeData[i]);
        }
    }

    // å¯¹è±¡è¶…è¿‡æ± å®¹é‡æ—¶é”€æ¯
    public void Dispose()
    {
        _maybeData = null;
    }
}
```

#### b.ğŸ“‚ **ä½¿ç”¨ PoolGroup æ³¨å†Œå¯¹è±¡æ± **

å®Œæˆå¯¹è±¡ç±»åï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼æ³¨å†Œå¯¹è±¡æ± ï¼š

1. **é€šè¿‡ `PoolManager` æ³¨å†Œ**

é€‚ç”¨äºå¤šä¸ªåœºæ™¯åŒºåˆ†å¯¹è±¡æ± çš„æƒ…å†µï¼š

```csharp
// æ³¨å†Œå¯¹è±¡æ± 
var createFun = () => new ExamplePoolObj();
PoolableObjectPool pool = PoolManager.instance.Register<ExamplePoolObj>(createFun, maxNum: 50, initNum: 10, groupName: PoolGroupName.Default);

// è·å–å¯¹è±¡
ExamplePoolObj item = PoolManager.instance.Get<ExamplePoolObj>(groupName: PoolGroupName.Default);

// ä¿®æ”¹å¯¹è±¡æ± å®¹é‡
PoolableObjectPool pool = PoolManager.instance.GetPool<ExamplePoolObj>(PoolGroupName.Default);
pool.SetMaxSize(100);

// å›æ”¶å¯¹è±¡
PoolManager.instance.Release(item, groupName: PoolGroupName.Default);

// æ³¨é”€å¯¹è±¡æ± 
PoolManager.instance.UnRegister<ExamplePoolObj>(PoolGroupName.Default);

// PoolManageræä¾›äº†æŒ‰ç…§PoolGroupNameæ¸…é™¤å¯¹è±¡æ± çš„åŠŸèƒ½
PoolManager.instance.ClearByGroup(PoolGroupName.Default);
PoolManager.instance.DisposeByGroup(PoolGroupName.Default);
```

2. **ç›´æ¥åˆ›å»º `PoolGroup`**

é€‚ç”¨äºå•ä¸ªåœºæ™¯å†…çš„éœ€æ±‚ï¼š

```csharp
var poolGroup = new PoolGroup(rootParent: transform, rootName: "ExamplePoolGroup");

// æ³¨å†Œå¯¹è±¡æ± 
var createFun = () => new ExamplePoolObj();
PoolableObjectPool pool = poolGroup.Push(createFun, maxNum: 50, initNum: 10);

// è·å–å¯¹è±¡
ExamplePoolObj item = poolGroup.Get<ExamplePoolObj>();

// å›æ”¶å¯¹è±¡
poolGroup.Release(item);

// æ¸…ç†å¯¹è±¡æ± 
poolGroup.Clear<ExamplePoolObj>();
```

3. **ç›´æ¥ä½¿ç”¨ `PoolableObjectPool`**

é€‚ç”¨äºå•ä¸€å¯¹è±¡æ± çš„éœ€æ±‚ï¼š

```csharp
// åˆ›å»ºå¯¹è±¡æ± 
var createFun = () => new ExamplePoolObj();
PoolableObjectPool pool = new PoolableObjectPool(createFun, maxSize: 50, initSize: 10);

// è·å–å¯¹è±¡
ExamplePoolObj item = pool.Get() as ExamplePoolObj;

// å›æ”¶å¯¹è±¡
pool.Release(item);

// æ¸…ç†å¯¹è±¡æ± 
pool.Clear();

// é”€æ¯å¯¹è±¡æ± 
pool.Dispose();
```

---

### 2.ğŸ–¼ï¸ **GameObject å¯¹è±¡æ± **

#### a.ğŸ”§ **é€šè¿‡ `PoolManager` ä½¿ç”¨å¯¹è±¡æ± **

é€‚ç”¨äºå¤šä¸ªåœºæ™¯åŒºåˆ†çš„ `GameObject` å¯¹è±¡æ± ï¼š

```csharp
var groupName = PoolGroupName.Default;

// æ³¨å†Œ GameObject å¯¹è±¡æ± 
PoolManager.instance.Register("PrefabPath", maxNum: 20, initNum: 5, groupName, () =>
{
    Debug.Log("GameObject Pool Initialized");
});

// è·å– GameObject
GameObject go = PoolManager.instance.GetGameObject("PrefabPath", groupName);

// å¼‚æ­¥è·å– GameObject
PoolManager.instance.GetGameObjectAsync("PrefabPath", go =>
{
    Debug.Log($"GameObject {go.name} Loaded");
}, groupName);

// å›æ”¶ GameObject
PoolManager.instance.Release(go, groupName);

// æ³¨é”€å¯¹è±¡æ± 
PoolManager.instance.UnRegister("PrefabPath", groupName);
```

#### b.ğŸ“‚ **é€šè¿‡ `PoolGroup` ä½¿ç”¨å¯¹è±¡æ± **

é€‚ç”¨äºå•ä¸ªåœºæ™¯å†…çš„éœ€æ±‚ï¼š

```csharp
// åˆ›å»º GameObject å¯¹è±¡æ± 
poolGroup.PushGameObjectPool("PrefabPath", maxNum: 20, initNum: 5, () =>
{
    Debug.Log("GameObject Pool Initialized");
});

// è·å– GameObject
GameObject go = poolGroup.GetGameObject("PrefabPath");

// å¼‚æ­¥è·å– GameObject
poolGroup.GetGameObjectAsync("PrefabPath", go =>
{
    Debug.Log($"GameObject {go.name} Loaded");
});

// å›æ”¶ GameObject
poolGroup.ReleaseGameObject(go);

// æ¸…ç†å¯¹è±¡æ± 
poolGroup.ClearGameObjectPool("PrefabPath");
```

#### c.âœ¨ **ç›´æ¥ä½¿ç”¨ `GameObjectPool`**

é€‚ç”¨äºå•ä¸€åœºæ™¯çš„éœ€æ±‚ï¼š

```csharp
// åˆ›å»º GameObjectPool
var pool = new GameObjectPool("PrefabPath", maxSize: 20, initSize: 5, root: transform);

// è·å– GameObject
GameObject go = pool.Get();

// å›æ”¶ GameObject
pool.Release(go);

// æ¸…ç†å¯¹è±¡æ± 
pool.Clear();

// é”€æ¯å¯¹è±¡æ± 
pool.Dispose();
```

---

## âš ï¸ **æ³¨æ„äº‹é¡¹**

1. **å¯¹è±¡æ± å®¹é‡ç®¡ç†**
  - å¯é€šè¿‡ `SetMaxSize` åŠ¨æ€è°ƒæ•´å¯¹è±¡æ± å®¹é‡ã€‚
  - è¶…å‡ºå®¹é‡çš„å¯¹è±¡ä¼šè¢«é”€æ¯ï¼Œè€Œéå›æ”¶åˆ°æ± ä¸­ã€‚

2. **è‡ªåŠ¨é”€æ¯åŠŸèƒ½**
  - `PoolGroup` æ”¯æŒ `autoDestroy` å±æ€§ï¼Œæ§åˆ¶æ˜¯å¦è‡ªåŠ¨é”€æ¯æœªå›æ”¶çš„å¯¹è±¡ã€‚

3. **åœºæ™¯ç®¡ç†**
  - ä½¿ç”¨ `PoolManager` å¯åœ¨å¤šä¸ªåœºæ™¯é—´åŒºåˆ†å¯¹è±¡æ± ã€‚
  - é€šè¿‡å•ç‹¬çš„ `PoolGroup` å¯åœ¨å•ä¸ªåœºæ™¯å†…ç®¡ç†å¯¹è±¡æ± ã€‚

4. **èµ„æºè·¯å¾„**
  - `GameObject` å¯¹è±¡æ± éœ€æä¾›æ­£ç¡®çš„èµ„æºè·¯å¾„ï¼Œç¡®ä¿èµ„æºå·²åŠ è½½ã€‚
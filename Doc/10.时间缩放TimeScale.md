# 时间工具类与时间管理系统

## 简介

这套时间工具类与时间管理系统提供了强大的时间操作功能，包括时间缩放、时间戳处理、日历生成、农历支持等。它适用于需要精确时间控制和多语言支持的游戏或应用程序。

---

## 功能特点

1. **时间缩放管理**：
   - 支持全局时间缩放 (`SetGlobalScale`)。
   - 支持堆栈式时间缩放 (`Push`, `Pop`)。
   - 支持时间缩放的平滑过渡。
   - 支持时间暂停与恢复。

2. **时间工具**：
   - 获取当前日期 (`GetToday`)。
   - 时间戳与 `DateTime` 的相互转换。
   - 时间间隔计算 (`GetTimeSpan`)。
   - 时间格式化为字符串（支持多语言）。

3. **日历生成**：
   - 支持阳历与农历日期。
   - 支持节假日与节气的显示。
   - 支持多语言（简体中文、繁体中文、英文）。

4. **农历支持**：
   - 农历日期计算。
   - 农历节日与节气显示。

5. **事件支持**：
   - 时间缩放变化事件。
   - 时间暂停与恢复事件。

---

## 使用方法

### 1. 时间缩放管理

#### TimeScaler

UFlow 构建了 `TimeScaler` 作为时间缩放管理的最小单位。

`TimeScaler` 存储用于时间缩放计算的值，分为一个基础值和数个混合值。混合值可以用堆形式 `Push` / `Pop` 操作。

最终计算的时间缩放数值，为基础值和混合值累乘得出。

通常情况，开发者不需要操作到 `TimeScaler`。可以将时间缩放操作交给 `TimeManager`。

#### 设置全局时间缩放
```csharp
TimeManager.instance.SetGlobalScale(0.5f); // 设置全局时间缩放为0.5倍
```

#### 推入时间缩放
```csharp
TimeManager.instance.Push(0.2f); // 推入一个0.2倍的时间缩放
```

#### 弹出时间缩放
```csharp
TimeManager.instance.Pop(); // 弹出最近的时间缩放
```

#### 暂停与恢复时间
```csharp
TimeManager.instance.PauseTime(); // 暂停时间
TimeManager.instance.ResumeTime(); // 恢复时间
```

#### 慢动作效果
```csharp
TimeManager.instance.DoSlowMotion(0.1f, 2f, 1f); // 慢动作：缩放到0.1倍，持续2秒，恢复时间1秒
```

---

### 2. 时间工具

#### 获取当前日期
```csharp
DateTime today = TimeUtils.GetToday();
```

#### 时间戳与 `DateTime` 转换
```csharp
long timeStamp = TimeUtils.GetTimeStamp(DateTime.Now); // 获取当前时间的时间戳
DateTime date = TimeUtils.GetTime(timeStamp); // 将时间戳转换为DateTime
```

#### 时间格式化
```csharp
string formattedTime = 3600.FormatTime(); // 格式化为 "01:00:00"
```

---

### 3. 日历生成

#### 初始化日历
```csharp
CalendarGenerator generator = new CalendarGenerator();
CalendarDay[] days = generator.GenerateCalendar(DateTime.Now); // 生成当前月份的日历
```

#### 获取农历日期
```csharp
string lunarDate = CalendarGenerator.GetLunarDate(DateTime.Now, out string lunarFestival);
```

#### 获取节日
```csharp
string festival = CalendarGenerator.GetFestival(DateTime.Now);
```

---

## 注意事项

1. **时间缩放堆栈**：
   - 时间缩放是基于堆栈实现的，确保 `Push` 和 `Pop` 成对使用。
   - 如果需要设置为0的时间缩放，请使用 `PauseTime` 方法。

2. **农历支持**：
   - 农历日期的计算依赖于 `ChineseLunisolarCalendar`，请确保日期在支持范围内。

3. **事件注册**：
   - 确保在模块初始化时正确注册和注销事件，以避免内存泄漏。

4. **多语言支持**：
   - 多语言支持依赖于 `LocalizationManager`，请确保正确配置语言环境。

---

## 示例

以下是一个完整的使用示例：

```csharp
// 初始化时间管理器
TimeManager.instance.OnInit();

// 设置全局时间缩放
TimeManager.instance.SetGlobalScale(0.8f);

// 推入一个时间缩放
TimeManager.instance.Push(0.5f);

// 暂停时间
TimeManager.instance.PauseTime();

// 恢复时间
TimeManager.instance.ResumeTime();

// 生成日历
CalendarGenerator generator = new CalendarGenerator();
CalendarDay[] days = generator.GenerateCalendar(DateTime.Now);

// 获取农历日期
string lunarDate = CalendarGenerator.GetLunarDate(DateTime.Now, out string lunarFestival);
```

---

## 结语

这套时间工具类与时间管理系统为开发者提供了灵活且强大的时间控制能力，适用于各种需要时间操作的场景。通过合理使用这些工具，可以显著提升项目的时间管理效率。

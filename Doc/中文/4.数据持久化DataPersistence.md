# æ•°æ®æŒä¹…åŒ–

## ğŸ˜€ æ¦‚è¿°

UFlowæä¾›ä¸€å¥—ç®€ä»‹æ˜“ç”¨çš„æ•°æ®æŒä¹…åŒ–å·¥å…·ï¼Œå¯ç”¨äºå­˜å‚¨:

    - PlayerPrefs
    - json
    - äºŒè¿›åˆ¶æ ¼å¼
    - å±å¹•æˆªå›¾

---

## ğŸ› ï¸ ä½¿ç”¨æ–¹æ³•

### 1.âœ¨ **å®šä¹‰è¦å­˜å‚¨çš„æ•°æ®**

ä½¿ç”¨`IPersistenceData`æ¥å£æ ‡è®°æŒä¹…åŒ–æ•°æ®ï¼š

```csharp
    [Serializable]
    public class PlayerSave: IPersistenceData
    {
        public long Id;
        public string Name;
    }
```

### 2.ğŸ’¾ **æ•°æ®ä¿å­˜**

é™¤äº†PlayerPrefsä»¥å¤–çš„æ•°æ®ï¼Œä½¿ç”¨`PlayerDataUtils`å·¥å…·ç±»å®ç°æ•°æ®åŒæ­¥/å¼‚æ­¥ä¿å­˜ï¼Œä¿å­˜çš„è·¯å¾„ä¸º
`{Application.persistentDataPath}/{ä¿å­˜æ ¼å¼}/{ç±»å or è‡ªå®šä¹‰æ–‡ä»¶å}.æ–‡ä»¶åç¼€`ã€‚

æ³¨æ„åœ¨WebGLå¹³å°ï¼Œ`PlayerDataUtils`ä¸ä¼šç¼–è¯‘å¼‚æ­¥è¿”å›Taskçš„ä¿å­˜æ–¹æ³•çš„ä»£ç ï¼Œè¿™æ˜¯ä¸ºäº†é¿å…å•çº¿ç¨‹çš„WebGLå¹³å°æŠ¥é”™ã€‚

ä¸‹é¢ä»¥ä¿å­˜äºŒè¿›åˆ¶æ ¼å¼ä¸ºä¾‹ï¼š

```csharp
public void Save(PlayerSave playerSave)
{
    // åŒæ­¥æ–¹æ³•ï¼Œå¹¶ä¸”å¯¹äºŒè¿›åˆ¶æ•°æ®åŠ å¯†
    // ä¿å­˜çš„è·¯å¾„ï¼š{Application.persistentDataPath}/Binary/PlayerSave.bytes
    PlayerDataUtils.SaveDataBinary(data: playerSave, encrypt: true);

    // åŒæ­¥æ–¹æ³•ï¼Œå¹¶ä¸”å¯¹äºŒè¿›åˆ¶æ•°æ®åŠ å¯†
    // ä¿å­˜çš„è·¯å¾„ï¼š{Application.persistentDataPath}/Binary/MySave.bytes
    PlayerDataUtils.SaveDataBinary(fileNameï¼š"MySave", data: playerSave, encrypt: true);

    // å¼‚æ­¥åŠ è½½ï¼Œè¿”å›Task
    Task task = PlayerDataUtils.SaveDataBinaryTask(playerSave);
    Task task1 = PlayerDataUtils.SaveDataBinaryTask("MySave", playerSave);

    // å¼‚æ­¥åŠ è½½ï¼Œè¿”å›Coroutine
    Coroutine coroutine = PlayerDataUtils.SaveDataBinaryAsync(playerSave)
    Coroutine coroutine1 = PlayerDataUtils.SaveDataBinaryAsync("MySave", playerSave)
}
```

### 3.ğŸ“‚ **æ•°æ®è¯»å–**

ä¸‹é¢ä»¥è¯»å–äºŒè¿›åˆ¶æ ¼å¼ä¸ºä¾‹ï¼š

```csharp
public PlayerSave Read(string fileName)
{
    // åŒæ­¥æ–¹æ³•è¯»å–
    if (string.IsNullOrEmpty(fileName))
    {
        return PlayerDataUtils.ReadBinary<PlayerSave>(decrypt:true);
    }
    return PlayerDataUtils.ReadBinary<PlayerSave>(fileName, decrypt:true);
}

public LoaderYieldInstruction<PlayerSave> ReadAsync(string fileName)
{
    // å¼‚æ­¥æ–¹æ³•è¯»å–
    if (string.IsNullOrEmpty(fileName))
    {
        return PlayerDataUtils.ReadBinaryAsync<PlayerSave>(OnLoadedSave);
    }
    return PlayerDataUtils.ReadBinaryAsync<PlayerSave>(fileName, OnLoadedSave);
}

public void OnLoadedSave(PlayerSave save)
{
    Debug.Log(save.Id);
}
```

### 4.âš™ï¸ **PlayerPrefs**

ä¹Ÿå¯ä»¥é€šè¿‡`PlayerDataUtils`å°†ç»§æ‰¿`IPersistenceData`æ¥å£çš„æ•°æ®ç±»ä¿å­˜åœ¨PlayerPrefså†…ï¼Œæ­¤æ—¶æ˜¯ä»¥jsonæ ¼å¼ä¿å­˜

```csharp
public PlayerSave Save(PlayerSave save)
{
    PlayerDataUtils.SavePlayerPrefs(save);

    // å¯ä»¥æä¾›è‡ªå®šä¹‰key
    PlayerDataUtils.SavePlayerPrefs("MySave", save);
}

public PlayerSave Read(string fileName)
{
    if (string.IsNullOrEmpty(fileName))
    {
        return PlayerDataUtils.ReadPlayerPrefs<PlayerSave>()
    }
    return PlayerDataUtils.ReadPlayerPrefs<PlayerSave>(fileName);
}
```

### 5.ğŸ“¸ **ä¿å­˜å±å¹•æˆªå›¾**

å¯ä»¥å¯¹å±å¹•æˆ–ç›¸æœºç”»é¢è¿›è¡Œæˆªå›¾å¹¶ä¿å­˜

```csharp
public PlayerSave Save(PlayerSave save)
{
    ApplicationManger.instance.StarCoroutine(Example("testCapture"))
}

public IEnumerator Example(string fileName)
{
    // æœ€åä¸€ä¸ªå‚æ•°æ˜¯ç›¸æœºï¼Œå¦‚æœä¼ å…¥ç›¸æœºä¸ºnullï¼Œåˆ™æˆªå–å±å¹•æˆªå›¾
    Coroutine coroutine = PlayerDataUtils.TakeCapture(fileName, new Rect(){width = 1080, height = 720}, Camera.main);
    yield return coroutine;
    // ä¿å­˜æˆåŠŸ

    // åŒæ­¥è¯»å–
    Sprite capture = PlayerDataUtils.LoadCapture(fileName);

    // å¼‚æ­¥è¯»å–
    LoaderYieldInstruction<Sprite> loadHandler = PlayerDataUtils.LoadCaptureAsync(fileName, null);
    yield return loadHandler;
    Sprite capture2 = loadHandler.asset;

    // åˆ é™¤æˆªå›¾
    PlayerDataUtils.DeleteCapture(fileName);
}
```
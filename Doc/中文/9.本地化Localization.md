# æœ¬åœ°åŒ–ç®¡ç†å·¥å…·æ–‡æ¡£

## åŸºäº Unity Localization æ’ä»¶

UFlowä½¿ç”¨äº† **Unity Localization** å®ç°å¤šè¯­è¨€åˆ‡æ¢ã€‚

ä¸ºäº†ç®€åŒ– **Unity Localization** ç›¸å¯¹å¤æ‚çš„é…ç½®æµç¨‹ï¼ŒåŒæ—¶å’ŒUFlowçš„é…ç½®è¡¨ç³»ç»Ÿç»„åˆï¼Œé¡¹ç›®å†…å¯¹ `UnityEngine.UI.Text` å’Œ
`TextMeshPro.TextMeshProUGUI` è¿›è¡Œäº†äºŒæ¬¡å¼€å‘ã€‚

å½“ç„¶ï¼Œå¼€å‘è€…ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ **Unity Localization** çš„åŸç”ŸåŠŸèƒ½å®ç°è¯­è¨€åˆ‡æ¢ã€‚

---

## ğŸŒ **å·¥å…·ç‰¹ç‚¹**

1. **å¤šè¯­è¨€æ”¯æŒ**
    - æ”¯æŒå¤šè¯­è¨€åˆ‡æ¢ï¼Œé»˜è®¤æ”¯æŒç®€ä½“ä¸­æ–‡ã€ç¹ä½“ä¸­æ–‡ã€è‹±æ–‡ã€æ—¥æ–‡ç­‰è¯­è¨€ã€‚
    - æä¾›è¯­è¨€åˆ‡æ¢äº‹ä»¶ï¼Œæ–¹ä¾¿åŠ¨æ€æ›´æ–°ç•Œé¢å†…å®¹ã€‚

2. **åŸºäº Unity.Localization**
    - ä½¿ç”¨ Unity.Localization æä¾›çš„ `StringTable` å’Œ `AssetTable` ç®¡ç†æœ¬åœ°åŒ–å­—ç¬¦ä¸²å’Œèµ„æºã€‚
    - æ”¯æŒåŠ¨æ€åŠ è½½æœ¬åœ°åŒ–å­—ç¬¦ä¸²å’Œèµ„æºã€‚

3. **åŠ¨æ€å­—ä½“åˆ‡æ¢**
    - æ ¹æ®è¯­è¨€è‡ªåŠ¨åˆ‡æ¢å­—ä½“ï¼Œä»¥ç¡®ä¿ä¸åŒè¯­è¨€æ–‡å­—æ­£ç¡®æ˜¾ç¤ºã€‚
    - æ”¯æŒé€šè¿‡é…ç½®æ–‡ä»¶æŒ‡å®šä¸åŒè¯­è¨€çš„å­—ä½“è·¯å¾„ã€‚

4. **çµæ´»çš„æœ¬åœ°åŒ–ç»„ä»¶**
    - æä¾› `TextEx` å’Œ `TextMeshProUGUIEx` ç»„ä»¶ï¼Œæ”¯æŒé™æ€æ–‡æœ¬å’ŒåŠ¨æ€æœ¬åœ°åŒ–æ–‡æœ¬ã€‚
    - æ”¯æŒé€šè¿‡ Inspector é¢æ¿å¿«é€Ÿç”Ÿæˆå’Œç»‘å®šæœ¬åœ°åŒ– Keyã€‚

5. **äº‹ä»¶é©±åŠ¨**
    - æä¾› `onLanguageChange` äº‹ä»¶ï¼Œè¯­è¨€åˆ‡æ¢æ—¶è‡ªåŠ¨æ›´æ–°ç•Œé¢å†…å®¹ã€‚

6. **èµ„æºç®¡ç†é›†æˆ**
    - ä½¿ç”¨ `IAssetLoader` åŠ¨æ€åŠ è½½å­—ä½“èµ„æºï¼Œé¿å…èµ„æºæµªè´¹ã€‚

---

## ğŸ› ï¸ **ä½¿ç”¨æ–¹æ³•**

### 1. **åˆå§‹åŒ–æœ¬åœ°åŒ–ç®¡ç†å™¨**

æœ¬åœ°åŒ–ç®¡ç†å™¨ä¼šåœ¨æ¸¸æˆå¯åŠ¨æ—¶è‡ªåŠ¨åˆå§‹åŒ–ï¼Œæ— éœ€æ‰‹åŠ¨è°ƒç”¨ã€‚  
å¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç åˆå§‹åŒ–å¹¶è®¾ç½®é»˜è®¤è¯­è¨€ï¼š

```csharp
LocalizationManager.instance.Init(() =>
{
    Debug.Log("Localization Manager Initialized");
});
```

---

### 2. **è·å–æœ¬åœ°åŒ–å­—ç¬¦ä¸²**

#### a. **é€šè¿‡ Key è·å–å­—ç¬¦ä¸²**

```csharp
string localizedText = LocalizationManager.instance.GetString("example_key");
```

#### b. **å¸¦å‚æ•°çš„æœ¬åœ°åŒ–å­—ç¬¦ä¸²**

```csharp
string localizedText = LocalizationManager.instance.GetString("example_key", param1, param2);
```

#### c. **å°è¯•è·å–å­—ç¬¦ä¸²**

```csharp
if (LocalizationManager.instance.TryGetString("example_key", out string result))
{
    Debug.Log($"Localized Text: {result}");
}
```

---

### 3. **åˆ‡æ¢è¯­è¨€**

#### a. **åˆ‡æ¢åˆ°æŒ‡å®šè¯­è¨€**

```csharp
LocalizationManager.instance.ChangeLanguage(Language.English, () =>
{
    Debug.Log("Language switched to English");
});
```

#### b. **è·å–å½“å‰è¯­è¨€**

```csharp
Language currentLanguage = LocalizationManager.instance.curLanguage;
Debug.Log($"Current Language: {currentLanguage}");
```

---

### 4. **åŠ¨æ€å­—ä½“åˆ‡æ¢**

æœ¬åœ°åŒ–ç®¡ç†å™¨ä¼šæ ¹æ®å½“å‰è¯­è¨€è‡ªåŠ¨åŠ è½½å¯¹åº”çš„å­—ä½“èµ„æºã€‚

å¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç è·å–å½“å‰è¯­è¨€çš„å­—ä½“ï¼š

```csharp
Font currentFont = LocalizationManager.instance.font;
```

å¦‚æœä½¿ç”¨ `TextEx` ç»„ä»¶ï¼Œå¹¶åœ¨é¢æ¿ä¸Šå‹¾é€‰äº† `change Font When Lan Change` ä¸ºtrueï¼Œåˆ‡æ¢è¯­è¨€æ—¶ä¼šè‡ªåŠ¨åˆ‡æ¢å­—ä½“

---

### 5. **æœ¬åœ°åŒ–ç»„ä»¶**

#### a. **ä½¿ç”¨ `TextEx`**

- `TextEx` æ˜¯ Unity åŸç”Ÿ `Text` çš„æ‰©å±•ï¼Œå¯ä»¥ç›´æ¥å½“æˆ `Text` ç»„ä»¶ä½¿ç”¨ã€‚
- æä¾›äº†å¿«æ·æ·»åŠ  `TextEx` ç»„ä»¶çš„æ–¹æ³•ï¼Œåœ¨ Hierarchy ä¸Šä½¿ç”¨å³é”®èœå• `Create -> UI -> TextEx` å¯ä»¥ç›´æ¥åˆ›å»ºã€‚
- ä¹Ÿå¯ä»¥åœ¨ Hierarchy ä¸Šä½¿ç”¨å³é”®èœå• `GameObject/UI/Replace TextEx` æ›¿æ¢ `Text` æˆ– `TextMeshProUGUI` ä¸º `TextEx`ã€‚
- åœ¨ Inspector é¢æ¿ä¸­å‹¾é€‰ `Static Text`ï¼Œå¹¶ä¾æ¬¡ç‚¹å‡» `ç”Ÿæˆæœ¬åœ°åŒ–Key`ã€`æ·»åŠ æœ¬åœ°åŒ–Keyåˆ°é…ç½®`ï¼Œç»„ä»¶ä¼šè‡ªåŠ¨ç”Ÿæˆ**key**å¹¶å°†**key
  **æ·»åŠ åˆ°**Localization Table**ä¸Šã€‚
- å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆçš„**key**ï¼Œè€Œæ˜¯æ·»åŠ å…¶ä»–**key**ï¼ŒInspector ä¸Šä¼šåŒæ­¥æ˜¾ç¤ºè¿™ä¸ª**key**åœ¨é»˜è®¤è¯­è¨€ä¸Šçš„å€¼ã€‚
- éœ€è¦ä¿æŒå­—ä½“èµ„æºä¸å˜ï¼Œåœ¨ Inspector é¢æ¿ä¸­å–æ¶ˆå‹¾é€‰ `change Font When Lan Change`ã€‚

#### b. **ä½¿ç”¨ `TextMeshProUGUIEx`**

- `TextMeshProUGUIEx` æ˜¯ `TextMeshProUGUI` çš„æ‰©å±•ï¼Œå¯ä»¥ç›´æ¥å½“æˆ `TextMeshProUGUI` ç»„ä»¶ä½¿ç”¨ã€‚
- å’Œ `TextEx` ç›¸åŒï¼Œæä¾›äº†å³é”®èœå•ï¼Œå¯ä»¥å¿«é€Ÿåˆ›å»º `TextMeshProUGUIEx`ï¼Œæˆ–å°† `Text`ã€ `TextMeshProUGUI` æ›¿æ¢ä¸º
  `TextMeshProUGUIEx`ã€‚
- å’Œ `TextEx` ç›¸åŒï¼Œæä¾›ä¾¿æ·åˆ›å»º/æ·»åŠ **key**çš„åŠŸèƒ½ã€‚

#### c. **åŠ¨æ€è®¾ç½®æœ¬åœ°åŒ–æ–‡æœ¬**

```csharp
var textEx = GetComponent<TextEx>();
textEx.SetLocalizationText("example_key_1", "param1", "param2");

var textMeshProEx = GetComponent<TextMeshProUGUIEx>();
textMeshProEx.SetLocalizationText("example_key_2");
```

æ³¨æ„ï¼Œä½¿ç”¨ `SetLocalizationText()` å `TextEx`/`TextMeshProUGUIEx` ä¼šè‡ªåŠ¨æ³¨å†Œ
`onLanguageChange` äº‹ä»¶ï¼Œå¹¶ç¼“å­˜è¾“å…¥çš„keyå’Œå‚æ•°ï¼Œåœ¨è¯­è¨€å˜åŒ–æ—¶è‡ªåŠ¨åˆ‡æ¢å¯¹åº”è¯­è¨€ã€‚

#### d. **åŠ¨æ€åŠ è½½æœ¬åœ°åŒ–é…ç½®èµ„æº**

æ¡†æ¶å†…æä¾›äº†ä¸‰ä¸ªç»§æ‰¿è‡ª`AssetLocalizationSwitch`çš„ç»„ä»¶â€”â€” `ImageLocalization`ã€ `PrefabLocalization` å’Œ `SpriteRendererLocalization`ã€‚
ä¸‰ä¸ªç»„ä»¶åˆ†åˆ«æä¾›æ ¹æ®å½“å‰è¯­è¨€è‡ªåŠ¨åˆ‡æ¢ Imageã€SpriteRendererå’ŒPrefabã€‚
ä½¿ç”¨æ–¹æ³•å’Œ `TextEx` ç›¸ä¼¼ï¼Œé…ç½® **key** åï¼Œåœ¨è¿è¡Œæ—¶ä¼šè‡ªåŠ¨åŠ è½½é…ç½®åœ¨ **AssetsTable** ä¸­çš„èµ„æºã€‚
---

### 6. **æœ¬åœ°åŒ–èµ„æº**

#### a. **è·å–æœ¬åœ°åŒ–èµ„æº GUID**

```csharp
string assetGuid = LocalizationManager.instance.GetAssetGuid("example_asset_key");
```

#### b. **å°è¯•è·å–èµ„æº GUID**

```csharp
if (LocalizationManager.instance.TryGetAssetGuid("example_asset_key", out string result))
{
    Debug.Log($"Localized Asset GUID: {result}");
}
```

#### c. **é€šè¿‡Localizationå†…ç½®ApiåŠ è½½èµ„æº**

```csharp
// å¼‚æ­¥åŠ è½½æœ¬åœ°åŒ–èµ„æº
var handler = LocalizationManager.instance.AsyncOperationHandle<T>("example_asset_key");
handler.Completed += (assetHandler) =>
    {
        if (assetHandler.Status != AsyncOperationStatus.Succeeded) return;
        T asset = assetHandlder.Result; 
        // TODO something...
    }

// 
LocalizationManager.instance.ReleaseAsset("example_asset_key");
```

#### c. **å’Œé…ç½®è¡¨å·¥å…·ç»“åˆä½¿ç”¨**

é…ç½®è¡¨å·¥å…·æ”¯æŒå°†é…ç½®è¡¨ä¸­çš„æœ¬åœ°åŒ–å­—ç¬¦ä¸²æå–å¹¶å¯¼å‡ºä¸º CSV æ–‡ä»¶ï¼Œæ–¹ä¾¿ç»Ÿä¸€ç®¡ç†å’Œç¿»è¯‘ã€‚ä»¥ä¸‹æ˜¯ç»“åˆä½¿ç”¨çš„æ­¥éª¤ï¼š

1. **åœ¨é…ç½®è¡¨ä¸­å®šä¹‰æœ¬åœ°åŒ–å­—æ®µ**  
   åœ¨ Excel é…ç½®è¡¨ä¸­ï¼Œå°†éœ€è¦æœ¬åœ°åŒ–çš„å­—æ®µç±»å‹è®¾ç½®ä¸º `LocString` æˆ– `LocAsset`ã€‚ä¾‹å¦‚ï¼š
   ```plaintext
   | æ³¨é‡Š       | id | åç§°       | æè¿°               |
   | å­—æ®µåç§°   | id | roleName       | description        |
   | å­—æ®µç±»å‹   | int| LocString  | LocString          |
   |------------|----|------------|--------------------|
   | æ•°æ®       | 1  | hero_name  | hero_description   |
   | æ•°æ®       | 2  | monster_name| monster_description|
   ```

2. **æå–æœ¬åœ°åŒ–å­—ç¬¦ä¸²**  
   åœ¨ `Config Setting Window` ä¸­ç‚¹å‡» **Create Localization csv** æŒ‰é’®ï¼Œå·¥å…·ä¼šè‡ªåŠ¨æå–é…ç½®è¡¨ä¸­çš„æœ¬åœ°åŒ–å­—æ®µå¹¶ç”Ÿæˆ CSV æ–‡ä»¶ã€‚

3. **ç¿»è¯‘ CSV æ–‡ä»¶**  
   å°†ç”Ÿæˆçš„ CSV æ–‡ä»¶äº¤ç»™ç¿»è¯‘äººå‘˜è¿›è¡Œç¿»è¯‘ï¼Œå®Œæˆåå°†ç¿»è¯‘åçš„ CSV æ–‡ä»¶å¯¼å…¥ Unity é¡¹ç›®ä¸­çš„ StringTableã€‚

   å°†csvå¯¼å…¥é¡¹ç›®çš„æ“ä½œå¯å‚è€ƒ Unityå®˜æ–¹æ–‡æ¡£(https://docs.unity3d.com/Packages/com.unity.localization@1.4/manual/CSV.html)

4. **ç›´æ¥ä»é…ç½®è¡¨æ•°æ®ä¸­è·å¾—æœ¬åœ°åŒ–æ–‡æœ¬**  
   LocString å’Œ LocAsset ç±»å‹é‡å†™äº† `ToString()` æ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥ä»é…ç½®è¡¨æ•°æ®ä¸­è·å¾—æœ¬åœ°åŒ–æ–‡æœ¬ï¼Œæ— éœ€é¢å¤–å¤„ç†ã€‚

   ```csharp
   var configData = ConfigManger.instance.RoleConf.Get(id);
   // è·å–æœ¬åœ°åŒ–æ–‡æœ¬
   string localizedText = configData.roleName.ToString(); 
   // æˆ–ä½¿ç”¨ Get() æ–¹æ³•
   string localizedText = configData.description.Get();
   ```

---

## âš ï¸ **æ³¨æ„äº‹é¡¹**

1. **æœ¬åœ°åŒ– Key ç®¡ç†**
    - ç¡®ä¿æ‰€æœ‰æœ¬åœ°åŒ– Key å”¯ä¸€ä¸”æ­£ç¡®é…ç½®åœ¨ `StringTable` æˆ– `AssetTable` ä¸­ã€‚

2. **å­—ä½“èµ„æºè·¯å¾„**
    - åœ¨é…ç½®æ–‡ä»¶ä¸­ä¸ºæ¯ç§è¯­è¨€æŒ‡å®šå¯¹åº”çš„å­—ä½“è·¯å¾„ï¼Œç¡®ä¿å­—ä½“èµ„æºæ­£ç¡®åŠ è½½ã€‚

3. **åŠ¨æ€åŠ è½½èµ„æº**
    - æœ¬åœ°åŒ–èµ„æºå’Œå­—ä½“é€šè¿‡ `IAssetLoader` åŠ¨æ€åŠ è½½ï¼Œéœ€ç¡®ä¿èµ„æºè·¯å¾„æ­£ç¡®ã€‚

4. **äº‹ä»¶ç›‘å¬**
    - ä½¿ç”¨ `onLanguageChange` äº‹ä»¶ç›‘å¬è¯­è¨€åˆ‡æ¢ï¼ŒåŠ¨æ€æ›´æ–°ç•Œé¢å†…å®¹ã€‚

5. **ç»„ä»¶ä½¿ç”¨**
    - ä½¿ç”¨ `TextEx` å’Œ `TextMeshProUGUIEx` æ—¶ï¼Œéœ€åœ¨ Inspector é¢æ¿ä¸­æ­£ç¡®è®¾ç½® `Localization Key`ã€‚

6. **æ€§èƒ½ä¼˜åŒ–**
    - é¿å…é¢‘ç¹åˆ‡æ¢è¯­è¨€ï¼Œå‡å°‘ä¸å¿…è¦çš„èµ„æºåŠ è½½ã€‚

---

## ğŸ“‚ **æ–‡ä»¶ç»“æ„**

```plaintext
Editor/
   â””â”€â”€ UI/
         â”œâ”€â”€ TextExEditor.cs                # TextEx çš„è‡ªå®šä¹‰ Inspector
         â””â”€â”€ TextMeshProUGUIExEditor.cs     # TextMeshProUGUIEx çš„è‡ªå®šä¹‰ Inspector
Systems/
   â””â”€â”€ LocalizationSystem/
         â””â”€â”€ LocalizationManager.cs         # æœ¬åœ°åŒ–ç®¡ç†å™¨ä¸»é€»è¾‘
Toolkit/
   â””â”€â”€ UIToolKit/
         â”œâ”€â”€ TextEx.cs                      # æ”¯æŒæœ¬åœ°åŒ–çš„ Text ç»„ä»¶
         â””â”€â”€ TextMeshProUGUIEx.cs           # æ”¯æŒæœ¬åœ°åŒ–çš„ TextMeshPro ç»„ä»¶
```

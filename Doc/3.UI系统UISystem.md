# UIç³»ç»Ÿ

## ğŸ˜€ æ¦‚è¿°
æ¡†æ¶å†…ä½¿ç”¨çš„UIè§£å†³æ–¹æ¡ˆæ˜¯ä¸€ä¸ªåŸºäºUnityçš„UIæ¡†æ¶ï¼Œä½¿ç”¨åŸºäºPageçš„å †ç®¡ç†é€»è¾‘ï¼Œæä¾›äº†ç•Œé¢çš„åŠ è½½ã€æ˜¾ç¤ºã€å…³é—­ã€ç®¡ç†ç­‰åŠŸèƒ½ã€‚
ä¸»è¦æ¥å£å¦‚ä¸‹ï¼š

| æ¥å£åç§° | ç”¨é€” |
|--------|------|
|`IUIComponent` | `IUIParent`, `IUIChild`çš„åŸºç¡€æ¥å£ã€‚|
|`IUIParent` | çˆ¶èŠ‚ç‚¹æ¥å£ï¼ŒåŒ…å«å­èŠ‚ç‚¹çš„åŠ è½½ã€æ˜¾ç¤ºå…³é—­ç®¡ç†ã€‚|  
|`IUIChild` | å­èŠ‚ç‚¹æ¥å£ï¼Œæœ‰ä¸¤ä¸ªç‰¹æ®Šçš„å­æ¥å£`IUIPoolable`å’Œ`IUIStandAlone`ã€‚|
|`IUIPoolable`| ç»§æ‰¿`IUIPoolable`ä¼šä»ä¸“ç”¨éƒ½å¯¹è±¡æ± IUIParentåŠ è½½å’Œå­˜æ”¾ã€‚|
|`IUIStandAlone`| ç»§æ‰¿`IUIStandAlone`ä¼šåœ¨UIæœ€ä¸Šå±‚æ˜¾ç¤ºï¼Œå¹¶ä¸”ä¸è¢«Pageç³»ç»Ÿç®¡ç†ã€‚|
|`IOpenWindowRequest`| çˆ¶èŠ‚ç‚¹ä¸Šç”¨æ¥ç®¡ç†åŠ è½½å­èŠ‚ç‚¹è¿‡ç¨‹çš„ä¸­é—´å±‚ã€‚|

ä»¥ä¸‹æ˜¾ç¤ºUIæ¡†æ¶çš„ç»“æ„ï¼š

```plaintext 
IUIParent
    |
    â””â”€â”€> IOpenWindowRequestâ”€â”€>IUIChild;
                                |
                                |â”€â”€> IUIPoolable;
                                |
                                â””â”€â”€> IUIStandAlone;
```

---

## ğŸ› ï¸ ä½¿ç”¨

### 1.âœ¨ **åˆ›å»ºUI**

#### a.ğŸŒŸ **åˆ›å»ºä¸€ä¸ªPageç±»ï¼Œç»§æ‰¿`UIPage`**
æ¡†æ¶å†…çš„pageä½œä¸ºwindowçš„å®¹å™¨ï¼Œå¹¶ä¸éœ€è¦é¢„åˆ¶ä½“ã€‚

åœ¨è°ƒç”¨æ‰“å¼€pageæ—¶ï¼Œç³»ç»Ÿä¼šåˆ›å»ºä¸€ä¸ª`GameObject`ï¼Œå¹¶å°†pageç»„ä»¶æ·»åŠ å…¶ä¸Šï¼Œå› æ­¤ä¸è¦å°½é‡ä¸åœ¨pageä¸Šæ·»åŠ **éœ€è¦æŒ‚è½½ç»„ä»¶**çš„åŠŸèƒ½ã€‚

æ ¹æ®ä»¥ä¸Šè¯´æ˜å¯ä»¥æ¨ç†å‡ºï¼Œæ‰“å¼€pageå…¶å®æ˜¯åŒæ­¥åˆ›å»ºã€‚å› æ­¤å¼€å‘è€…å¯ä»¥é©¬ä¸Šæ“ä½œåˆ›å»ºçš„pageã€‚

ä»¥ä¸‹ä¸ºpageçš„å®ä¾‹ä»£ç ï¼š

```csharp
public class TestPage : UIPage
{
    public override void OnOpen(object data)
    {
        // æ‰“å¼€Pageæ—¶è°ƒç”¨
    }

    public override void OnClose()
    {
        // å…³é—­Pageæ—¶è°ƒç”¨
    }

    public override void RegisterEvent()
    {
        // æ³¨å†Œäº‹ä»¶
    }

    public override void DeregisterEvent()
    {
        // æ³¨é”€äº‹ä»¶
    }
    
    public override void OnFocus()
    {
        // è·å¾—ç„¦ç‚¹æ—¶è°ƒç”¨
    }
}
```

#### b.ğŸ–¼ï¸ **åˆ›å»ºä¸€ä¸ªWindowç±»ï¼Œç»§æ‰¿`UIWindow`**

ä»…æœ‰pageï¼Œå¹¶ä¸ä¼šæ˜¾ç¤ºä»»ä½•å¯è§çš„äº¤äº’ç•Œé¢ï¼Œéœ€è¦åœ¨pageä¸ŠåŠ è½½windowã€‚

ä¸pageä¸åŒï¼Œéœ€è¦ä¸ºæ¯ä¸ªwindowæ­å»ºé¢„åˆ¶ä½“ï¼Œå¹¶æå‰æŒ‚è½½å¥½éœ€è¦çš„ç»„ä»¶ã€‚

windowä½¿ç”¨`[WindowInfo(string path, bool ignoreRaycast = false)]`å±æ€§æ ‡è®°é¢„åˆ¶ä½“è·¯å¾„ï¼Œåœ¨æ‰“å¼€windowæ—¶é€šè¿‡åå°„è·å–é¢„åˆ¶ä½“è·¯å¾„ï¼Œç„¶åé€šè¿‡pageçš„`IAssetLoader`åŠ è½½ã€‚

windowåŠ è½½æ˜¯å¼‚æ­¥è¿‡ç¨‹ï¼Œå¿…é¡»åœ¨ç•Œé¢åŠ è½½å®Œæˆåï¼Œæ‰èƒ½æ“ä½œç•Œé¢ã€‚

ä»¥ä¸‹ä¸ºwindowçš„å®ä¾‹ä»£ç ï¼š

```csharp
// WindowInfoç”¨æ¥æ ‡è®°UIé¢„åˆ¶ä½“è·¯å¾„ä½ç½®
[WindowInfo(path: "Assets/Res/WindowPrefabPath.prefab", ignoreRaycast: false)]
public class TestWindow : UIWindowï¼Œ // æ ¹æ®éœ€è¦ï¼Œå¯ä»¥ç»§æ‰¿ IUIPoolable æˆ– IUIStandAlone
{
    public virtual void RegisterEvent()
    {
        // æ³¨å†Œäº‹ä»¶
        if(closeBtn) closeBtn.onClick.AddListener(OnCloseBtnClick);
    }
        
    public virtual void DeregisterEvent()
    {
        // æ³¨é”€äº‹ä»¶
        if(closeBtn) closeBtn.onClick.RemoveListener(OnCloseBtnClick);
    }
        
    public override void OnOpen(object data)
    {
        // æ‰“å¼€UIæ—¶è°ƒç”¨
    }

    public override void OnClose()
    {
        // å…³é—­UIæ—¶è°ƒç”¨
    }

    public override void OnFocus()
    {
        // è·å¾—ç„¦ç‚¹æ—¶è°ƒç”¨
    }
}
```

#### c.ğŸ”§ **çµæ´»åˆ©ç”¨Page-Windowç³»ç»Ÿ**
æ„å»ºPage-Windowçš„ç›®çš„æ˜¯ï¼Œåœ¨å¤§éƒ¨åˆ†å•†ä¸šé¡¹ç›®ä¸­ï¼Œå­˜åœ¨å¤šä¸ªåœºæ™¯ï¼ˆä¸»ç•Œé¢ã€æˆ˜æ–—ã€èƒŒåŒ…ç­‰ï¼‰ï¼Œåœ¨ä¸åŒåœºæ™¯åˆ‡æ¢æ—¶ï¼Œé€šå¸¸æ—¶å…³é—­ä¹‹å‰çš„UIç»„åˆï¼Œå†æ‰“å¼€æ–°çš„UIç»„åˆï¼Œpageçš„æ¦‚å¿µå°±èƒ½å°†è¿™äº›ä¸åŒçš„ç»„åˆå½’çº³è¾¾åˆ°ä¸€èµ·ï¼Œæ–¹ä¾¿ä¸åŒUIåœºæ™¯çš„ç®¡ç†ã€‚

åŒæ—¶ï¼Œå› ä¸ºpageæ˜¯ä»¥å †æ¨¡å¼æ¥ç®¡ç†çš„ï¼Œå…³é—­æ—¶å¯ä»¥ä¿ç•™å½“å‰çš„windowçŠ¶æ€ã€‚å½“é¡¶éƒ¨çš„pageå…³é—­ï¼Œä¸‹ä¸€ä¸ªpageä¼šè‡ªåŠ¨æ‰“å¼€ã€‚è¿™ä¾¿å¯ä»¥å®ç°å›åˆ°å‰ä¸€ä¸ªåœºæ™¯ã€‚

ä»¥ä¸‹åœºæ™¯ä¸ºä¾‹ï¼š

```plaintext

    | BattlePage                    |
    |       â”œâ”€â”€ BattleMainWindow    |
    |       â””â”€â”€ TaskWindow          |
    | LobbyPage                     |
    |       â”œâ”€â”€ LobbyMainWindow     |
    |       â”œâ”€â”€ ChatRoomWindow      |
    |       â””â”€â”€ TaskWindow          |
    | LoginPage                     |
    |       â”œâ”€â”€ SignInWindow        |
    |       â””â”€â”€ SignUpWindow        |
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

```

##### d.ğŸšª **æ‰“å¼€page**

åœ¨è¿›å…¥æ¸¸æˆæ—¶æ‰“å¼€`LoginPage`ï¼Œä¹‹åæ‰“å¼€`SignInWindow`ï¼Œæ ¹æ®éœ€è¦æ‰“å¼€`SignUpWindow`
```csharp
public class LoginPage : UIPage
{
    public override void OnOpen(object data)
    {
        base.OnOpen();
        var lastUserId = LoadLastUserId();
        // å¯ä»¥åœ¨ page æ‰“å¼€æ—¶ç›´æ¥æ‰“å¼€ window
        UIManager.instance.OpenWindow<SignInWindow>(lastUserId);
    }

    ...
}

...
// åœ¨æŸå¤„æ‰“å¼€ LoginPage
public void ReadyForGame()
{
    UIManager.instance.PushPage<LoginPage>();
}
...

```

å®Œæˆç™»å½•ä¹‹åï¼Œç©å®¶è¿›å…¥å¤§å…ï¼Œä½¿ç”¨`UIManager.instance.PushPage`åï¼Œ`LobbyPage`ä¼šè¿›å…¥pageå †ä¸Šéƒ¨ï¼Œæ­¤æ—¶å¹¶ä¸ä¼šå…³é—­`LoginPage`ä¸Šçš„ç•Œé¢ï¼Œåªæœ‰åœ¨æ‰“å¼€æ–°ç•Œé¢åï¼Œ`LoginPage`ä¼šè‡ªåŠ¨å…³é—­ã€‚
```csharp
UIManager.instance.PushPage<LobbyPage>();
UIManager.instance.OpenWindow<LobbyMainWindow>();
UIManager.instance.OpenWindow<ChatRoomWindow>();
UIManager.instance.OpenWindow<TaskWindow>();
```

##### e.âŒ **å…³é—­page**
åœ¨ä¸Šé¢æƒ…å†µä¸‹ï¼Œ`LoginPage`å¯èƒ½åœ¨å¾ˆé•¿ä¸€æ®µäº‹ä»¶éƒ½ä¸ä¼šå†æ¬¡æ‰“å¼€ï¼Œä»¥ä¸‹æœ‰ä¸¤ç§æ–¹æ³•ç§»é™¤`LoginPage`ï¼Œ

åœ¨æ‰“å¼€æ–°pageæ—¶ï¼Œä½¿ç”¨`UIManager.instance.PushPage<T>(object data = null, bool replaceMode = false)`å‚æ•°ä¸­çš„replaceModeï¼Œä¼ å…¥`true`åˆ™ä¼šå…³é—­å½“å‰å †é¡¶éƒ¨çš„pageï¼Œå¹¶é”€æ¯ã€‚

åŸæ¥çš„ä»£ç æ”¹ä¸ºï¼š

```csharp
UIManager.instance.PushPage<LobbyPage>(replaceModeï¼štrue);
UIManager.instance.OpenWindow<LobbyMainWindow>();
UIManager.instance.OpenWindow<ChatRoomWindow>();
UIManager.instance.OpenWindow<TaskWindow>();
```

æˆ–è€…è°ƒç”¨`UIManager.instance.ClosePage<T>(bool destroy = true, Action callback = null)`æ‰‹åŠ¨å°†`LoginPage`é”€æ¯

åŸæ¥çš„ä»£ç æ”¹ä¸ºï¼š
```csharp
UIManager.instance.PushPage<LobbyPage>();
UIManager.instance.OpenWindow<LobbyMainWindow>();
UIManager.instance.OpenWindow<ChatRoomWindow>();
UIManager.instance.OpenWindow<TaskWindow>();

UIManager.instance.ClosePage<LoginPage>(true);
```

##### f.ğŸ”„ **æ¨å‡ºpageé¡¶éƒ¨**

åœ¨è¿›å…¥BattlePageåï¼ˆreplaceMode = falseï¼Œå³ä¸æ˜¯ç”¨å…³é—­å½“å‰pageçš„æ–¹å¼è¿›å…¥ï¼‰ï¼š

```csharp
UIManager.instance.PushPage<BattlePage>(replaceModeï¼šfalse);
UIManager.instance.OpenWindow<BattleMainWindow>();
UIManager.instance.OpenWindow<TaskWindow>();
```

ç©å®¶è¿›è¡Œå®Œæˆ˜æ–—åè¦è¿”å›å¤§å…ï¼š
```csharp
UIManager.instance.PopPage();
```

æ­¤æ—¶`BattlePage`ä»å †é¡¶éƒ¨è¢«æ¨å‡ºï¼Œå¹¶å®è¡Œé”€æ¯æµç¨‹ã€‚

è€Œ`LobbyPage`æˆä¸ºå †é¡¶éƒ¨çš„pageï¼Œæ­¤æ—¶ä¼šè°ƒç”¨`LobbyPage.OnFocus()`æ–¹æ³•ï¼Œç„¶åè·å–pageå…³é—­æ—¶è¿˜å¤„äºå¼€å¯çŠ¶æ€çš„windowï¼ŒæŒ‰ç…§ä»–ä»¬çš„æ˜¾ç¤ºé¡ºåºï¼Œä»é¡¶å±‚åˆ°åº•å±‚è°ƒç”¨å„è‡ªçš„`OnFocus()`æ–¹æ³•ã€‚

å…¶å®åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ`LobbyPage`å’Œ`BattlePage`éƒ½å­˜åœ¨äºpageå †ä¸­ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è°ƒç”¨
```csharp
UIManager.instance.PushPage<LobbyPage>(replaceModeï¼štrue);
```
å®ç°ç›¸ä¼¼çš„æ•ˆæœï¼Œä½†æ­¤æ—¶`LobbyPage`è°ƒç”¨çš„æ˜¯`OnOpen()`æ–¹æ³•ï¼Œè€Œä¸æ˜¯`OnFocus()`æ–¹æ³•ã€‚å…¶ä¸‹çš„windowä¹Ÿä¸ä¼šè°ƒç”¨å„è‡ªçš„`OnFocus()`æ–¹æ³•ã€‚

### 2 â›º ç‰¹æ®Šçš„Windowæ¥å£

æ¡†æ¶å†…æä¾›äº†ä¸¤ä¸ª Window çš„æ¥å£ï¼Œ`IUIPoolable` & `IUIStandAlone`ã€‚

ç»§æ‰¿ `IUIPoolable` çš„ window åœ¨å…³é—­æ—¶ä¼šåœ¨å›æ”¶åˆ°ä¸“ç”¨çš„å¯¹è±¡æ± Pageã€‚

ç»§æ‰¿ `IUIStandAlone` ä¼šåœ¨UIæœ€ä¸Šå±‚æ˜¾ç¤ºï¼Œå¹¶ä¸”ä¸å—å½“å‰Pageå¼€å…³å½±å“ã€‚

å’Œæ­£å¸¸çš„ window çš„å¼€å¯/å…³é—­ç”¨æ³•ä¸€ç›´ï¼Œåœ¨ä½¿ç”¨æ—¶ä¸éœ€è¦åšé¢å¤–æ“ä½œã€‚

### 3 âš ï¸ æ³¨æ„äº‹é¡¹

1. Pageä¸Windowçš„ç”Ÿå‘½å‘¨æœŸ
    - Pageçš„OnOpenå’ŒOnFocusæ–¹æ³•åˆ†åˆ«åœ¨æ‰“å¼€å’Œè·å¾—ç„¦ç‚¹æ—¶è°ƒç”¨ã€‚
    - Windowçš„åŠ è½½æ˜¯å¼‚æ­¥çš„ï¼Œå¿…é¡»åœ¨åŠ è½½å®Œæˆåæ“ä½œã€‚

2. Pageå †ç®¡ç†
    - Pageä»¥å †çš„å½¢å¼ç®¡ç†ï¼Œé¡¶éƒ¨Pageå…³é—­åä¼šè‡ªåŠ¨å›åˆ°ä¸‹ä¸€ä¸ªPageã€‚

3. Windowè·¯å¾„æ ‡è®°
    - ä½¿ç”¨[WindowInfo]æ ‡è®°Windowçš„é¢„åˆ¶ä½“è·¯å¾„ï¼Œç¡®ä¿è·¯å¾„æ­£ç¡®ã€‚

4. èµ„æºç®¡ç†
   - Pageå’ŒWindowçš„åŠ è½½ä¾èµ–äºIAssetLoaderï¼Œéœ€ç¡®ä¿èµ„æºç®¡ç†å·¥å…·æ­£å¸¸å·¥ä½œã€‚

5. ä¸€ä¸ªPageä¸Šä¸å…è®¸å­˜åœ¨ä¸¤ä¸ªç›¸åŒç±»å‹çš„windowã€‚
## ğŸŒ æ¨¡å—ä¸­æ¢

### ğŸ“– æ¦‚è¿°

åœ¨å¤§éƒ¨åˆ†å•†ä¸šæ¸¸æˆä¸­ï¼Œä¸ºäº†å¯¹ä¸åŒæ¸¸ç©å†…å®¹åŒºåˆ†ç®¡ç†ï¼Œé€šå¸¸ä¼šå®šä¹‰ä¸€äº›å•ä¾‹è„šæœ¬ã€‚

UFlowä½¿ç”¨æ¥å£ï¼Œç»“åˆæ¡†æ¶å†…çš„`EventManager`ã€`SingletonBase<T>`ç­‰å·¥å…·èµ‹äºˆå•ä¾‹ä»¥ç”Ÿå‘½å‘¨æœŸã€‚

å¼€å‘è€…å¯ä»¥æ ¹æ®åŠŸèƒ½æ¨¡å—éœ€è¦çš„åŠŸèƒ½ï¼Œç»§æ‰¿éœ€è¦çš„æ¥å£å³å¯ã€‚

---

### ğŸ› ï¸ ä½¿ç”¨

#### ğŸš€ 1.**å¯åŠ¨æµç¨‹**

`ModuleManager`ä¼šåœ¨æ¸¸æˆå¯åŠ¨æ—¶ï¼Œåœ¨èµ„æºå·¥å…·åŠ è½½å®Œæˆåè°ƒç”¨åˆå§‹åŒ–ã€‚

`ModuleManager`ä¼šé€šè¿‡åå°„ï¼Œè·å–`SingletonBase<T>`å’Œ`MonoSingleton<T>`çš„å¯å®ä¾‹ç±»å‹ï¼Œç»Ÿä¸€è¿›è¡Œå®ä¾‹åŒ–ã€‚

ä¹‹åå¯ä»¥è‡ªè¡Œå¯¹ç®¡ç†ä¸­æ¨¡å—å•ä¾‹è¿›è¡Œæ·»åŠ æˆ–è€…åˆ é™¤ã€‚

å› æ­¤ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸éœ€è¦å¼€å‘è€…æ‰‹åŠ¨å®ä¾‹åŒ–è¿™äº›ç®¡ç†å™¨ã€‚

#### ğŸ“œ 2.**æ¥å£ä»‹ç»**

UFlowå†…éƒ¨æä¾›äº†`SingletonBase<T>`å’Œ`MonoSingleton<T>`ä½œä¸ºå•ä¾‹æ¨¡å¼çš„åŸºç±»ã€‚

åŒºåˆ«åœ¨äºï¼Œ`MonoSingleton<T>`å®ç°çš„å•ä¾‹ä¼šåœ¨åœºæ™¯ä¸Šå­˜åœ¨`GameObject`ä½œä¸ºè½½ä½“ï¼Œå› æ­¤å¯ä»¥ç›´æ¥ä½¿ç”¨å…¶ä¸Šçš„`transform`ã€`gameObject`å’ŒUnityç”Ÿå‘½å‘¨æœŸã€‚

æ³¨æ„ï¼Œåœ¨æŸäº›æƒ…å†µï¼Œå¸Œæœ›ä¸€äº›å•ä¾‹èƒ½æ¯”å…¶ä»–å•ä¾‹æ›´æ—©å®ä¾‹åŒ–æ—¶ï¼Œå¯ä»¥ç”¨`[ModuleInitOrder(int order)]`å¯¹ç±»è¿›è¡Œæ’åºï¼Œæ²¡æœ‰`ModuleInitOrder`çš„å•ä¾‹ä¼šåœ¨ç”Ÿæˆæ’åºçš„æœ«å°¾ã€‚

æ„å»ºä¸€ä¸ªæ¨¡å—ç®¡ç†å™¨åªéœ€å¦‚ä¸‹ï¼š

```csharp
// ä½¿ç”¨ ModuleInitOrder æ ‡æ³¨æ¨¡å—å®ä¾‹åŒ–é¡ºåºï¼Œæ•°å­—è¶Šå°å®ä¾‹åŒ–è¶Šæ—©
[ModuleInitOrder(300)]
public class ExampleModuleManager : SingletonBase<ExampleModuleManager>
{
    // your code...
}

[ModuleInitOrder(100)]
public class ExampleMonoManager ï¼š MonoSingleton<ExampleMonoManager>
{
    // your code...
}
```

å¼€å‘è€…å¯ä»¥ä½¿ç”¨æä¾›çš„æ¥å£å¯¹`SingletonBase<T>`ç®¡ç†å™¨è¿›è¡Œä¿®é¥°ï¼Œ`MonoSingleton<T>`å› ä¸ºæœ¬èº«æœ‰Unityç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œå¯ä»¥åªç»§æ‰¿`IModule`ã€‚

ä»¥ä¸‹æ˜¯æä¾›çš„æ¥å£ï¼š

```csharp
public interface IModule : IDisposable
{
    /// <summary>
    /// è‡ªåŠ¨åœ¨ç¨‹åºåˆå§‹åŒ–æ—¶ï¼Œå¯¹æ¨¡å—æ—¶åˆå§‹åŒ–
    /// ç»§æ‰¿IDisposableï¼Œåœ¨æ¸¸æˆè¿›ç¨‹å…³é—­æ—¶ã€è¢«æ¨¡å—ç®¡ç†å™¨æ‰‹åŠ¨ç§»é™¤è°ƒç”¨Dispose()
    /// </summary>
    public void OnInit();
}

public interface IOnGameStartModule : IModule
{
    /// <summary>
    /// EventManager.instance.onStartGameäº‹ä»¶è§¦å‘æ—¶è¢«è°ƒç”¨
    /// </summary>
    public void OnGameStart();
}

public interface IOnGameResetModule : IModule
{
    /// <summary>
    /// EventManager.instance.onResetGameäº‹ä»¶è§¦å‘æ—¶è¢«è°ƒç”¨
    /// ä¸€èˆ¬æ˜¯åœ¨ç©å®¶é€€å‡ºå½“å‰è´¦å·ï¼Œå›åˆ°ç™»å½•ç•Œé¢æ—¶è¢«è°ƒç”¨
    /// å¯åœ¨è¿™é‡Œå¯¹æ•°æ®é‡ç½®
    /// </summary>
    public void OnGameReset();
}

public interface IExecutionModule : IModule
{
    public bool inExecution { set; get; }
    /// <summary>
    /// åœ¨Unityçš„Updateä¸­æ‰§è¡Œ
    /// </summary>
    public void Execute(float dt);
}

public interface ILaterExecutionModule : IModule
{
    public bool inExecution { set; get; }
    /// <summary>
    /// åœ¨Unityçš„LaterUpdateä¸­æ‰§è¡Œ
    /// </summary>
    public void LaterExecute(float dt);
}

public interface IEventModule : IModule
{
    /// <summary>
    /// ç®¡ç†å™¨å®ä¾‹åŒ–æ—¶è°ƒç”¨ä¸€æ¬¡ï¼Œä¸€èˆ¬ç”¨äºäº‹ä»¶æ³¨å†Œ
    /// </summary>
    public void RegisterEvent();
    /// <summary>
    /// ç®¡ç†å™¨è¢«ç§»é™¤æˆ–è€…æ¸¸æˆè¿›ç¨‹åœæ­¢æ—¶è°ƒç”¨ï¼Œä¸€èˆ¬ç”¨äºäº‹ä»¶æ³¨é”€
    /// </summary>
    public void UnRegisterEvent();
}
```

#### ğŸ•’ 3.**å½“ä½ éœ€è¦ä¸€ä¸ªä¸´æ—¶å•ä¾‹**

æŸäº›æƒ…å†µä½ ç¡®å®éœ€è¦ä¸€ä¸ªæ–¹ä¾¿çš„ç±»å‹ï¼Œè®©ä½ éšæ—¶å¯ä»¥è·å–éœ€è¦çš„æ•°æ®ï¼ŒåŒæ—¶åˆå¸Œæœ›åœ¨ä¸éœ€è¦æ—¶å¯ä»¥åˆ é™¤å®ƒã€‚

å½“ç„¶å¯ä»¥ï¼Œåªè¦ä½¿ç”¨`TempMonoSingleton<T>`å°±è¡Œã€‚

`TempMonoSingleton<T>`åŸºæœ¬ä¸Šå°±æ˜¯`MonoSingleton<T>`ï¼Œä½†`TempMonoSingleton<T>`ä¸å—`ModuleManager`ç®¡ç†ï¼Œå› æ­¤`IMudule`æ¥å£å¯¹å®ƒä¹Ÿæ²¡æœ‰å®é™…ä½œç”¨ï¼Œå¼€å‘è€…éœ€è¦è‡ªè¡Œç®¡ç†è¿™ä¸ªå®ä¾‹ã€‚

æ„å»ºä¸€ä¸ª`TempMonoSingleton<T>`çš„æ–¹å¼å¾ˆç®€å•ï¼š

```csharp
public class ExampleTempManager ï¼šTempMonoSingleton<ExampleTempManager>
{
    public override void Init(object data)
    {
        base.Init(data);
        // do something with data...
    }

    public void SomeLogic()
    {
        // do something...
    }
}
```

å¦‚ä½•åœ¨ä»£ç é‡Œé¢ä½¿ç”¨ï¼š

```csharp
// å®ä¾‹åŒ–ä¸€ä¸ªä¸´æ—¶å•ä¾‹
TempMonoSingleton<ExampleTempManager>.Create(data);

Debug.Log(TempMonoSingleton<ExampleTempManager>.isExist); // true

// è°ƒç”¨å•ä¾‹é€»è¾‘
ExampleTempManager.instance.SomeLogic();

// é”€æ¯å•ä¾‹çš„å®ä¾‹
ExampleTempManager.instance.Deinit();

Debug.Log(TempMonoSingleton<ExampleTempManager>.isExist); // false
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæ²¡æœ‰é”€æ¯å•ä¾‹å°±å†æ¬¡åˆ›å»ºå•ä¾‹ï¼Œåˆ™ä¼šå¯¼è‡´å‰ä¸€ä¸ªå•ä¾‹ï¼ˆåŒ…æ‹¬GameObjectï¼‰è¢«é”€æ¯ï¼Œå•ä¾‹åªä¼šæŒ‡å‘æ–°å®ä¾‹åŒ–çš„å¯¹è±¡ã€‚